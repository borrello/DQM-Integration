process DQM={
    
    untracked PSet maxEvents = {untracked int32 input = -1}

     source = EventStreamHttpReader{
       string sourceURL = "http://cmsdisk1.cms:11100/urn:xdaq-application:service=storagemanager"
       int32 max_event_size = 7000000
       int32 max_queue_depth = 5
       untracked string consumerName = "RPC DQM Source"
       untracked string consumerPriority = "normal"
       untracked int32 headerRetryInterval = 3
       untracked double maxEventRequestRate = 2.5
       untracked PSet SelectEvents = { vstring SelectEvents={"*"} }
     }

    include "Geometry/MuonCommonData/data/muonIdealGeometryXML.cfi"
    include "Geometry/RPCGeometry/data/rpcGeometry.cfi"
    include "Geometry/MuonNumbering/data/muonNumberingInitialization.cfi"

###############    Raw To Digi:   #########################
#      include "EventFilter/RPCRawToDigi/data/RPCOrconCabling.cfi"



    include "CondCore/DBCommon/data/CondDBSetup.cfi"
    es_source RPCCabling = PoolDBESSource {
    #  using CondDBSetup
      string timetype = "runnumber"
      string connect = "frontier://(serverurl=http://frontier1.cms:8000/FrontierOn)(serverurl=http://frontier2.cms:8000/FrontierOn)(retrieve-ziplevel=0)/CMS_COND_ON_170_RPC"
      PSet DBParameters = {
	  untracked int32 messageLevel = 0
	  untracked string authenticationPath = "/nfshome0/hltpro/cmssw/cfg/"
      }
      VPSet toGet = {
	{ string record = "RPCEMapRcd" string tag = "RPCEMap_v2" }
      }
      untracked bool siteLocalConfig = false
    }







      module rpcunpacker = RPCUnpackingModule{
         untracked InputTag InputLabel = source
      }

#################    Data Quality Monitoring:   #########################

    # back-end interface service
    service = DaqMonitorROOTBackEnd{
        untracked int32 verbose = 0 
    }
    
    # send source _AND_ client histograms out to collector every 5000 events
    service = DQMShipMonitoring{
	// event-period for shipping monitoring to collector (default: 25)
	// untracked uint32 period = 100
    }

    # MonitorDaemon configuration
    # optionally use the following line instead of the ones below
    # include "DQMServices/Examples/test/dqm_monitorDaemon.cfi"
    service = MonitorDaemon{
        untracked bool AutoInstantiate = true
	untracked string DestinationAddress = "srv-c2d05-19"
	untracked int32 SendPort = 9090
        untracked int32 maxAttempts2Reconnect    = 99999
        untracked string NameAsSource = "RPC"
    }

    #########################################################
    #### BEGIN DQM Online Environment #######################
    #########################################################
    include "DQMServices/Components/test/dqm_onlineEnv.cfi"
    replace dqmSaver.fileName      = "RPC"
    replace dqmSaver.dirName       = "/data1/dropbox"
    replace dqmEnv.subSystemFolder = "RPC"

    # optionally change fileSaving  conditions
    # replace dqmSaver.prescaleLS =   1
    // replace dqmSaver.prescaleTime = -1 # in minutes
    // replace dqmSaver.prescaleEvt =  -1
    // replace dqmSaver.saveAtRunEnd = true
    // replace dqmSaver.saveAtJobEnd = false
    # will add switch to select histograms to be saved soon

    #########################################################
    #### END ################################################
    #########################################################

    include "DQM/RPCMonitorDigi/data/RPCDigiMonitoring.cfi"    
    replace rpcdigidqm.DigiEventsInterval = 100 
    replace rpcdigidqm.dqmshifter = true
    # replace rpcdigidqm.dqmexpert = true
    replace rpcdigidqm.DigiDQMSaveRootFile = false

    service = MessageLogger {
	untracked vstring destinations = { 
	    "detailedInfo" , "critical" , "cout"
	}
	untracked vstring debugModules = { "*" }
	untracked PSet critical     = { untracked string threshold = "ERROR"   }
	untracked PSet detailedInfo = { untracked string threshold = "INFO"    } 
	untracked PSet cout = {
          untracked string threshold = "WARNING"
           untracked bool noLineBreaks = true
	    untracked PSet WARNING = {untracked int32 limit = 0 }
	}
    }	

     path p ={rpcunpacker, rpcdigidqm, dqmEnv , dqmSaver }

} 
