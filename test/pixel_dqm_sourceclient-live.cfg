process SIPIXELDQM = {

  #=========================================================================================
  # Sources
    source = EventStreamHttpReader{
    #     string sourceURL = "http://cmsdisk1.cms:11100/urn:xdaq-application:service=storagemanager"
	  string sourceURL = "http://srv-c2d05-14.cms:22100/urn:xdaq-application:lid=30"
    #     string sourceURL = "http://srv-c2c07-19.cms:11100/urn:xdaq-application:service=storagemanager"
    #     string sourceURL = "http://cmsmondev:50082/urn:xdaq-application:lid=29"
          int32 max_event_size = 7000000
          int32 max_queue_depth = 5

          untracked string consumerName = "Pixel DQM Consumer"
          untracked string consumerPriority = "normal"
          untracked int32 headerRetryInterval = 3  // seconds
          untracked double maxEventRequestRate = 10  // hertz
   #      untracked PSet SelectEvents = { vstring SelectEvents={"*"} }
          untracked PSet SelectEvents = { vstring SelectEvents={"*DQM"} }
    }
    untracked PSet maxEvents = {untracked int32 input = -1}
  # End Sources
  #=========================================================================================

  # MessageLogger service
 	 include "FWCore/MessageLogger/data/MessageLogger.cfi"

  #=========================================================================================
    service = AdaptorConfig {}
  #=========================================================================================
  # Geometry
	# Tracker SimGeometryXML
  	#include "Geometry/TrackerSimData/data/trackerSimGeometryXML.cfi"
        # cms geometry
        include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"
  	# Tracker Geometry Builder
  	include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"
  	# Tracker Numbering Builder
  	include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"
   	# magn. field
   	#include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"
    #-------------------------------------------------
    ## MAGNETIC FIELD
    #-------------------------------------------------
    ### Magnetic fiuld: force mag field to be 0.0 tesla
    include "MagneticField/Engine/data/uniformMagneticField.cfi"
    replace UniformMagneticFieldESProducer.ZFieldInTesla = 0.0
    es_prefer = UniformMagneticFieldESProducer{}

  # End Geometry
  
  #-------------------------------------------------
  ## CALIBRATION
  #-------------------------------------------------
    
  include "Configuration/StandardSequences/data/FakeConditions.cff"

  #If Frontier is used in xdaq environment use the following service
#  service = SiteLocalConfigService {}
  
  
  #include "CondTools/SiPixel/data/SiPixelCalibConfiguration.cfi"
  #replace sipixelcalib_essource.toGet = {
#	{
#		string record = "SiPixelFedCablingMapRcd"
#		#string tag = "SiPixelFedCablingMap_v9"
#		string tag = "SiPixelFedCablingMap_v10_mc"
#	}
#  }
  #=========================================================================================
    #-----------------------
    ####  Reconstruction Modules
    #-----------------------
    
    #include "Configuration/GlobalRuns/data/ReconstructionGR.cff"
    ## offline raw to digi for MC
    include "Configuration/StandardSequences/data/RawToDigi.cff"
    replace siPixelDigis.IncludeErrors = true
	
	
  # SiPixel DQM Modules:
    # SiPixelMonitorRawData
    	include "DQM/SiPixelMonitorRawData/data/SiPixelMonitorRawData.cfi"

    # SiPixelMonitorDigi
    	include "DQM/SiPixelMonitorDigi/data/SiPixelMonitorDigi.cfi"
	
  ################ The Client (SiPixelEDAClient) ################
   module sipixelEDAClient = SiPixelEDAClient {
     untracked int32  SummaryCreationFrequency = 1
     untracked int32  StaticUpdateFrequency = 1
   }
  # End Modules Configuration
  #=========================================================================================
  
  # DQM services
    include "DQMServices/Core/data/DQM.cfg"    
    // replace DQMStore.referenceFileName = "/home/dqm/tracker/pixel_reference.root"
    
  # DQM Online Environment
    # use include file for dqmEnv dqmSaver
    include "DQMServices/Components/data/DQMEnvironment.cfi"
    replace dqmSaver.convention    = "Online"
    replace dqmSaver.dirName       = "."
    replace dqmSaver.producer      = "DQM"
    replace dqmEnv.subSystemFolder = "Pixel"
    replace dqmSaver.saveByLumiSection = 1
    # replace dqmSaver.saveByMinute    = -1
    # replace dqmSaver.saveByEvent     = -1
    replace dqmSaver.saveByRun         = 1
    replace dqmSaver.saveAtJobEnd      = true

  #=========================================================================================

   service = ModuleWebRegistry { }

######################## Scheduling
    sequence DIGIreco = {
      siPixelDigis
    }
    sequence RAWmonitor = {
      SiPixelRawDataErrorSource
    }
    sequence DIGImonitor = {
      SiPixelDigiSource
    }
    sequence DQMmodules = {
      dqmEnv,
      dqmSaver
    }
    
  # End Schedule
  #=========================================================================================
  path p = {DIGIreco,RAWmonitor,DIGImonitor,sipixelEDAClient,DQMmodules}
  #path p = {RAWmonitor,DIGImonitor,sipixelEDAClient,DQMmodules}
  #path p = {DIGImonitor,sipixelEDAClient,DQMmodules}

}
