process SiStripDQMFile = {
    
    service = MessageLogger {
        untracked vstring destinations = { "cout" }
        untracked PSet cout = { untracked string threshold = "ERROR" }
        untracked vstring debugModules   = { "siPixelDigis",
                                             "siStripDigis",
                                             "siStripClusters",
                                             "siStripZeroSuppression",
                                             "SiStripClusterizer"}
    }

    #-------------------------------------------------
    ## MAGNETIC FIELD
    #-------------------------------------------------
    ### Magnetic fiuld: force mag field to be 0.0 tesla
    include "Configuration/GlobalRuns/data/ForceZeroTeslaField.cff"
 
    #-------------------------------------------------
    ## GEOMETRY
    #-------------------------------------------------
    
    # tracker geometry
    include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"
    
    # tracker numbering
    include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"
    
    # cms geometry
    include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"
    
    #-------------------------------------------------
    ## CALIBRATION
    #-------------------------------------------------
   es_source siStripCond = poolDBESSource from "CalibTracker/Configuration/data/Common/PoolDBESSource.cfi"
   replace siStripCond.toGet = {
        { string record = "SiStripPedestalsRcd"  string tag = "SiStripPedestals_TKCC_20X_v3_hlt"} ,
        { string record = "SiStripNoisesRcd"     string tag = "SiStripNoise_TKCC_20X_v3_hlt"} ,
        { string record = "SiStripBadChannelRcd" string tag = "SiStripBadChannel_TKCC_20X_v3_hlt"},
        { string record = "SiStripFedCablingRcd" string tag = "SiStripFedCabling_TKCC_20X_v3_hlt"}
    }
    #for oracle access in p5 uncomment
    replace siStripCond.connect="oracle://cms_orcon_prod/CMS_COND_20X_STRIP"
    replace siStripCond.DBParameters.authenticationPath="/nfshome0/xiezhen/conddb"

    #for oracle access at cern uncomment
    #replace siStripCond.connect="oracle://cms_orcoff_prod/CMS_COND_20X_STRIP"
    #replace siStripCond.DBParameters.authenticationPath="/afs/cern.ch/cms/DB/conddb"

    #for Frontier  access outside cern
    #replace siStripCond.connect="frontier://Frontier/CMS_COND_20X_STRIP"
    #replace siStripCond.DBParameters.authenticationPath=""

    es_module sistripconn = SiStripConnectivity {}

    include "CalibTracker/SiStripESProducers/data/SiStripQualityESProducer.cfi"
    replace SiStripQualityESProducer.ListOfRecordToMerge = {
       { string record = "SiStripDetCablingRcd" string tag = "" },
       { string record = "SiStripBadChannelRcd" string tag = "" }
    }

    include "RecoVertex/BeamSpotProducer/data/BeamSpotEarlyCollision.cfi"
    replace BeamSpotEarlyCollision.connect = "oracle://cms_orcon_prod/CMS_COND_20X_BEAMSPOT"

    #
    ## Fake Conditions
    #
    include "CalibTracker/Configuration/data/SiStripGain/SiStripGain_Fake.cff"
    include "CalibTracker/Configuration/data/SiStripLorentzAngle/SiStripLorentzAngle_Fake.cff"
    include "CalibTracker/Configuration/data/SiPixelLorentzAngle/SiPixelLorentzAngle_Fake.cff"

    #If Frontier is used in xdaq environment use the following service
#    service = SiteLocalConfigService {}

    #-----------------------
    ####  Reconstruction Modules
    #-----------------------
    
    include "Configuration/StandardSequences/data/ReconstructionCosmics.cff"
    replace CTF_P5_MeasurementTracker.pixelClusterProducer = ""
    replace RS_P5_MeasurementTracker.pixelClusterProducer = ''
    ## offline raw to digi for Data
    include "Configuration/StandardSequences/data/RawToDigi_Data.cff"

    #--------------------------
    #### DQMServices
    #--------------------------
    
    ### DQMStore Service
    include "DQMServices/Core/data/DQM.cfg"
    replace DQMStore.referenceFileName = "/home/dqmdevlocal/reference/sistrip_reference.root"
    replace DQM.filter = "^SiStrip(/[^/]+){0,5}$"

#    replace DQM.collectorHost = "srv-c2d05-18.cms"
#    replace DQM.collectorPort=9090
    
    ####  DQM File Saving and Environment
    include "DQMServices/Components/data/DQMEnvironment.cfi"
    replace dqmSaver.convention       = "Online"
    replace dqmSaver.dirName          = "/tmp/trackerdqm/dqmdata"
    replace dqmSaver.producer         = "DQM"
    replace dqmEnv.subSystemFolder    = "SiStrip"

// replace dqmSaver.saveByLumiSection =  1
// replace dqmSaver.saveByMinute      = -1
// replace dqmSaver.saveByEvent       = -1
   replace dqmSaver.saveByRun         =  1
   replace dqmSaver.saveAtJobEnd      = true


   #### Quality Tester ####
   module qTester = QualityTester {
     untracked FileInPath qtList = "DQM/SiStripMonitorClient/data/sistrip_qualitytest_config.xml"
     untracked bool getQualityTestsFromFile = true	        
     untracked int32 prescaleFactor = 1
   }

    #--------------------------
    #### STRIP DQM Source and Client
    #--------------------------
    include "DQM/SiStripMonitorClient/data/SiStripSourceConfigP5.cff"

    # Client
    module SiStripClient = SiStripAnalyser {
    	untracked int32  StaticUpdateFrequency = 1
        untracked int32  TkMapCreationFrequency = -1
        untracked int32  SummaryCreationFrequency = 1
        PSet TkmapParameters =
        {
   	   untracked string trackerdatPath="CommonTools/TrackerMap/data/"
	   untracked string trackermaptxtPath="DQM/Integration/test/TkMap/"
	   untracked bool loadFedCabling=true
        }
    }

    #--------------------------
    #### Web Service
    #--------------------------
    service = ModuleWebRegistry { }

    #----------------------------
    #### Scheduling
    #-----------------------------
    
    sequence SiStripSources = { 	
      HardwareMonitor,
      SiStripMonitorDigi, 
      SiStripMonitorCluster, 
      SiStripMonitorTrack_ckf,
      MonitorTrackResiduals_ckf,
      TrackMon_ckf
    }

    sequence DQMCommon = {
      qTester,
      dqmEnv ,
      dqmSaver 
    }
    
    sequence RecoForDQM = {
       siStripDigis,
       offlineBeamSpot,     
       striptrackerlocalreco,
       ctftracksP5
    }
    path p = {
        RecoForDQM,
        DQMCommon,
	SiStripSources, 
        SiStripClient
    }

    service = AdaptorConfig {}

    #----------------------------
    #### Event Source
    #-----------------------------
    source = PoolSource { 
	untracked vstring fileNames = {
	}
    }
    include "DQM/Integration/test/sistrip_filelist.cff"
    untracked PSet maxEvents = {untracked int32 input = -1}
}
