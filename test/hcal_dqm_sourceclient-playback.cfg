
process HCALDQM = { 

	include "DQMServices/Core/data/DQM.cfg"
	replace DQM.collectorHost = "srv-c2d05-18.cms"
	replace DQM.collectorPort = 9090

	//include "DQM/HcalMonitorModule/data/HcalMonitorModule.cfi"
	//include "DQM/HcalMonitorClient/data/HcalMonitorClient.cfi"
	include "DQM/HcalMonitorModule/data/Hcal_FrontierConditions_GRuMM_ORCON.cff"
	//include "DQM/HcalMonitorModule/data/Hcal_FrontierConditions_GREN_ORCON.cff"
	include "FWCore/MessageLogger/data/MessageLogger.cfi"

	include "EventFilter/HcalRawToDigi/data/HcalRawToDigi.cfi"
        include "RecoLocalCalo/HcalRecProducers/data/HcalSimpleReconstructor-hbhe.cfi"
        include "RecoLocalCalo/HcalRecProducers/data/HcalSimpleReconstructor-ho.cfi"
        include "RecoLocalCalo/HcalRecProducers/data/HcalSimpleReconstructor-hf.cfi"

	path p = { hcalDigis, horeco, hfreco, hbhereco, hcalMonitor, hcalClient, dqmEnv, dqmSaver }

	untracked PSet options = {
		untracked vstring Rethrow = { "ProductNotFound", "TooManyProducts", "TooFewProducts" }
	}

	untracked PSet maxEvents = {untracked int32 input = -1}

      source = EventStreamHttpReader {
        string sourceURL = "http://cmsmondev:50082/urn:xdaq-application:lid=29"
        # string sourceURL = "http://cmsdisk1.cms:11100/urn:xdaq-application:service=storagemanager"
        # string sourceURL = "http://srv-c2c07-19.cms:11100/urn:xdaq-application:service=storagemanager"
        int32 max_event_size = 7000000
        int32 max_queue_depth = 5
        untracked string consumerName = "HCAL DQM Consumer"
        untracked string consumerPriority = "normal"
        untracked int32 headerRetryInterval = 3
        untracked double maxEventRequestRate = 10
        untracked PSet SelectEvents = { vstring SelectEvents={"*"} }
      }

	module hcalMonitor = HcalMonitorModule{

		#Determines connection to back-end daemon
		untracked bool MonitorDaemon = true
	       	
		# Verbosity Switch
		untracked bool debug = false

		# Choices for prescaling your module (-1 mean no prescale)
		# Operate every N events
		untracked int32 diagnosticPrescaleEvt = -1
		# Operate every N lumi sections
		untracked int32 diagnosticPrescaleLS  = -1
		# Operate every N minutes
		untracked int32 diagnosticPrescaleTime = -1
		# Operate every N updates
		untracked int32 diagnosticPrescaleUpdate = -1


		# Labels for input products
                InputTag digiLabel = hcalDigis
                InputTag hbheRecHitLabel = hbhereco
                InputTag hfRecHitLabel = hfreco
                InputTag hoRecHitLabel = horeco
  	        InputTag gtLabel = l1GtUnpack

		#Flags for HotCellMonitor.  Thresholds are in GeV

                untracked bool HotCellMonitor = false
                untracked vdouble thresholds={1,1.5,2.,5,15}

                // NADA params updated for Jan DQM challenge using GREN data
                untracked double NADA_Ecand_cut0 = 1.5 // orig values was 1.0
                untracked double NADA_Ecand_cut1 = 2.5 // orig value was 2.5
                untracked double NADA_Ecand_cut2 = 500.
                untracked double NADA_Ecube_cut = 0.5 // orig value was 0.1
                untracked double NADA_Ecell_cut = 0.1
                untracked double NADA_Ecube_frac=0.30 // orig vale was 0.02
                untracked double NADA_Ecell_frac=0.02
                untracked int32 NADA_maxdepth=0
                untracked int32 NADA_maxeta=1
                untracked int32 NADA_maxphi=1
                untracked double NADA_NegCand_cut = -1.5
                
   
                #Flags for DeadCellMonitor
                untracked bool DeadCellMonitor = false
                untracked double coolcellfrac = 0.5 // fraction of cell's neighbors that must be significantly hotter than the cell for the cell to be considered "cool"
                untracked int32 checkNevents = 25 
                untracked double ped_Nsigma = 0
                untracked double minADCcount = 0
                untracked double deadcellfloor = -10. // cells below this energy are automatically set as "cool"
                untracked double deadcellmindiff = 1. // cell must be at least this much below neighbors to be considered a cool cell candidate 

		#Flags for RecHitMonitor.  Threshold is in GeV
	        untracked bool RecHitMonitor = true
	        untracked bool RecHitsPerChannel = false
	        untracked double RecHitOccThresh = 2.0  
	       
		#Flags for DigiMonitor.  Threshold is in ADC counts
		untracked bool DigiMonitor = true
		untracked bool DigisPerChannel = false
		untracked int32 DigiOccThresh = 0

		#Flags for DataFormatMonitor
		untracked bool DataFormatMonitor = true
		untracked int32 dfPrtLvl = 0

		#Flags for MTCCMonitor.  Thresholds are in fC
		#Dump threshold in fC, ranges in iEta/iPhi.  Dumps to stdout
		untracked bool MTCCMonitor = false
		untracked double MTCCOccThresh = 10
		untracked double DumpThreshold = 500
		untracked int32 DumpEtaLow = 0
		untracked int32 DumpEtaHigh = 10
		untracked int32 DumpPhiLow = 10
		untracked int32 DumpPhiHigh = 10
	       
		#Flags for pedestal monitor
	        untracked bool PedestalMonitor = false
	        untracked bool PedestalsPerChannel = false
		untracked bool PedestalsInFC = false

		#Flags for LED monitor
	        untracked bool LEDMonitor = false
	        untracked bool LEDPerChannel = false
		untracked double LED_ADC_Thresh = -1000

		#Flags for TPG monitor
		untracked bool TrigPrimMonitor = true

		#Flags for the hcal template analysis
		untracked bool HcalAnalysis = false

		#Global HCAL DQM parameters.  
		#Sets range of iEta/iPhi plots
		untracked double MaxEta = 41	
		untracked double MinEta = -41	
		untracked double MaxPhi = 73	
		untracked double MinPhi = 0	

		#List of known hot cells to veto using DetId
		untracked vstring HotCells = {}

                untracked bool checkHB=true
                untracked bool checkHE=true
                untracked bool checkHO=true
                untracked bool checkHF=true

                # HotCell Tags for individual subdetectors
                # If these aren't specified, then the global 
                # values are used

                #untracked bool HBdebug = false
                #untracked bool HEdebug = false
                #untracked bool HOdebug = false
                #untracked bool HFdebug = false

                #untracked vdouble HBthresholds={1,1.5,2.,5,15}
                #untracked vdouble HEthresholds={1,1.5,2.,5,15}
                #untracked vdouble HOthresholds={1,1.5,2.,5,15}
                #untracked vdouble HFthresholds={1,1.5,2.,5,15}

                #untracked double HBMaxEta = 41	
 		#untracked double HBMinEta = -41	
		#untracked double HBMaxPhi = 73	
		#untracked double HBMinPhi = 0	

                #untracked double HEMaxEta = 41	
 		#untracked double HEMinEta = -41	
		#untracked double HEMaxPhi = 73	
		#untracked double HEMinPhi = 0	

                #untracked double HOMaxEta = 41	
 		#untracked double HOMinEta = -41	
		#untracked double HOMaxPhi = 73	
		#untracked double HOMinPhi = 0	

                #untracked double HFMaxEta = 41	
 		#untracked double HFMinEta = -41	
		#untracked double HFMaxPhi = 73	
		#untracked double HFMinPhi = 0	

                #untracked double HB_NADA_Ecand_cut0 = 1.
                #untracked double HB_NADA_Ecand_cut1 = 5.
                #untracked double HB_NADA_Ecand_cut2 = 500.
                #untracked double HB_NADA_Ecube_cut = 0.1
                #untracked double HB_NADA_Ecell_cut = 0.1
                #untracked double HB_NADA_Ecube_frac=0.02
                #untracked double HB_NADA_Ecell_frac=0.02
                #untracked int32 HB_NADA_maxdepth=0
                #untracked int32 HB_NADA_maxeta=1
                #untracked int32 HB_NADA_maxphi=1
                #untracked double HB_NADA_NegCand_cut = -1.5
                
                #untracked double HE_NADA_Ecand_cut0 = 1.
                #untracked double HE_NADA_Ecand_cut1 = 5.
                #untracked double HE_NADA_Ecand_cut2 = 500.
                #untracked double HE_NADA_Ecube_cut = 0.1
                #untracked double HE_NADA_Ecell_cut = 0.1
                #untracked double HE_NADA_Ecube_frac=0.02
                #untracked double HE_NADA_Ecell_frac=0.02
                #untracked int32 HE_NADA_maxdepth=0
                #untracked int32 HE_NADA_maxeta=1
                #untracked int32 HE_NADA_maxphi=1
                #untracked double HE_NADA_NegCand_cut = -1.5
                
                #untracked double HO_NADA_Ecand_cut0 = 1.
                #untracked double HO_NADA_Ecand_cut1 = 5.
                #untracked double HO_NADA_Ecand_cut2 = 500.
                #untracked double HO_NADA_Ecube_cut = 0.1
                #untracked double HO_NADA_Ecell_cut = 0.1
                #untracked double HO_NADA_Ecube_frac=0.02
                #untracked double HO_NADA_Ecell_frac=0.02
                #untracked int32 HO_NADA_maxdepth=0
                #untracked int32 HO_NADA_maxeta=1
                #untracked int32 HO_NADA_maxphi=1
                #untracked double HO_NADA_NegCand_cut = -1.5
                
                #untracked double HF_NADA_Ecand_cut0 = 1.
                #untracked double HF_NADA_Ecand_cut1 = 5.
                #untracked double HF_NADA_Ecand_cut2 = 500.
                #untracked double HF_NADA_Ecube_cut = 0.1
                #untracked double HF_NADA_Ecell_cut = 0.1
                #untracked double HF_NADA_Ecube_frac=0.02
                #untracked double HF_NADA_Ecell_frac=0.02
                #untracked int32 HF_NADA_maxdepth=0
                #untracked int32 HF_NADA_maxeta=1
                #untracked int32 HF_NADA_maxphi=1
                #untracked double HF_NADA_NegCand_cut = -1.5
        }





	module hcalClient =  HcalMonitorClient{
		#Determines connection to back-end daemon
		untracked bool MonitorDaemon = true
	       	
		# Verbosity Switch
		untracked bool debug = false

		untracked string processName = ""

		# Choices for prescaling your module (-1 mean no prescale)
		# Operate every N events
		untracked int32 diagnosticPrescaleEvt = 200
		# Operate every N lumi sections
		untracked int32 diagnosticPrescaleLS  = -1
		# Operate every N minutes
		untracked int32 diagnosticPrescaleTime = -1
		# Operate every N updates
		untracked int32 diagnosticPrescaleUpdate = -1

		# Are we running as standalone process?
		untracked bool runningStandalone = false

		# Name of input DQM histogram file
		untracked string inputFile = ""

		# Directory for HTML output
	        # Disabled if set to ""
		untracked string baseHtmlDir = ''


		# Do you want this program to exit at the end of a run?
        untracked bool enableExit = false

		# Reset histograms on these frequencies
	    untracked int32 resetFreqUpdates = -1
	    untracked int32 resetFreqLS = -1
            untracked int32 resetFreqEvents = -1
	    untracked int32 resetFreqTime = -1

		# Analysis jobs to be run
	    untracked bool DataFormatClient = true
	    untracked bool DigiClient = true
	    untracked bool RecHitClient = true
	    untracked bool HotCellClient = false
       	    untracked bool DeadCellClient = false

            # for the moment, don't run CaloTowerClient unless explicitly requested
            untracked bool CaloTowerClient = false

	    untracked bool LEDClient = false
            untracked double LEDRMS_ErrThresh = 0.8
	    untracked double LEDMEAN_ErrThresh = 2.25

	    untracked bool PedestalClient = false
	    untracked bool plotPedRAW = true
	    untracked double PedestalRMS_ErrThresh = 1
	    untracked double PedestalMean_ErrThresh = 2
	    untracked double CapIdRMS_ErrThresh = 0.25
	    untracked double CapIdMEAN_ErrThresh = 1.5

	    untracked bool DoPerChanTests = false

		#Flags for TPG monitor
		untracked bool TrigPrimClient = true

		#Which subdetectors are present?
	    untracked vstring subDetsOn = {'HB', 'HE', 'HF', 'HO'}
      }


    #########################################################
    #### BEGIN DQM Online Environment #######################
    #########################################################
    # use include file for dqmEnv dqmSaver
       include "DQMServices/Components/test/dqm_onlineEnv.cfi"
       replace dqmSaver.fileName      = "Hcal"
       replace dqmSaver.dirName      = "/cms/mon/data/dropbox"
       replace dqmSaver.isPlayback    = true
       replace dqmEnv.subSystemFolder = "Hcal"
       
       # optionally change fileSaving  conditions
       replace dqmSaver.prescaleLS =   1
       // replace dqmSaver.prescaleTime = -1 # in minutes
       // replace dqmSaver.prescaleEvt =  -1
       // replace dqmSaver.saveAtRunEnd = true
       // replace dqmSaver.saveAtJobEnd = false
       # will add switch to select histograms to be saved soon
   
    #########################################################
    #### END ################################################
    #########################################################

}
