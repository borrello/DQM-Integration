process ECALDQM = { 

    #----------------------------
    #### Event Source
    #-----------------------------
    include "DQM/Integration/test/inputsource_playback.cfi"
    replace EventStreamHttpReader.consumerName = "EcalBarrel DQM Consumer"

    #----------------------------
    #### DQM Environment
    #-----------------------------
    include "DQMServices/Core/data/DQM.cfg"
###    replace DQMStore.referenceFileName = "/home/dqmdevlocal/reference/DQM_EcalBarrel_R000046798.root"

    include "DQMServices/Components/data/DQMEnvironment.cfi"

    #----------------------------
    #### DQM Playback Environment
    #-----------------------------
    include "DQM/Integration/test/environment_playback.cfi"
    replace dqmEnv.subSystemFolder    = "EcalBarrel"
    #-----------------------------


     include "EventFilter/EcalRawToDigiDev/data/EcalUnpackerMapping.cfi"
     include "EventFilter/EcalRawToDigiDev/data/EcalUnpackerData.cfi"

     module ecalUncalibHit2 = ecalFixedAlphaBetaFitUncalibRecHit from "RecoLocalCalo/EcalRecProducers/data/ecalFixedAlphaBetaFitUncalibRecHit.cfi"

     replace ecalUncalibHit2.MinAmplBarrel = 12.
     replace ecalUncalibHit2.MinAmplEndcap = 16.

     replace ecalUncalibHit2.EBdigiCollection = ecalEBunpacker:ebDigis
     replace ecalUncalibHit2.EEdigiCollection = ecalEBunpacker:eeDigis

     module ecalUncalibHit = ecalWeightUncalibRecHit from "RecoLocalCalo/EcalRecProducers/data/ecalWeightUncalibRecHit.cfi"

     replace ecalUncalibHit.EBdigiCollection = ecalEBunpacker:ebDigis
     replace ecalUncalibHit.EEdigiCollection = ecalEBunpacker:eeDigis

include "RecoLocalCalo/EcalRecProducers/data/ecalRecHit.cfi"

     replace ecalRecHit.EBuncalibRecHitCollection = ecalUncalibHit2:EcalUncalibRecHitsEB
     replace ecalRecHit.EEuncalibRecHitCollection = ecalUncalibHit2:EcalUncalibRecHitsEE

include "Geometry/CaloEventSetup/data/CaloGeometry.cfi"
include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"

include "Geometry/EcalMapping/data/EcalMapping.cfi"
include "Geometry/EcalMapping/data/EcalMappingRecord.cfi"

include "DQM/EcalBarrelMonitorModule/data/EcalBarrelMonitorModule.cfi"

include "DQM/EcalBarrelMonitorTasks/data/EcalBarrelMonitorTasks.cfi"

     replace ecalBarrelCosmicTask.EcalUncalibratedRecHitCollection = ecalUncalibHit2:EcalUncalibRecHitsEB
     replace ecalBarrelLaserTask.EcalUncalibratedRecHitCollection = ecalUncalibHit2:EcalUncalibRecHitsEB
     replace ecalBarrelTimingTask.EcalUncalibratedRecHitCollection = ecalUncalibHit2:EcalUncalibRecHitsEB

include "Geometry/CaloEventSetup/data/EcalTrigTowerConstituents.cfi"

include "SimCalorimetry/EcalTrigPrimProducers/data/ecalTriggerPrimitiveDigis.cff"
     replace ecalTriggerPrimitiveDigis.Label = "ecalEBunpacker"
     replace ecalTriggerPrimitiveDigis.InstanceEB = "ebDigis"
     replace ecalTriggerPrimitiveDigis.InstanceEE = "eeDigis"
     replace ecalTriggerPrimitiveDigis.BarrelOnly = true

     replace EcalTrigPrimESProducer.DatabaseFileEB = "TPG_EB.txt"
     replace EcalTrigPrimESProducer.DatabaseFileEE = "TPG_EE.txt"

include "DQM/EcalBarrelMonitorClient/data/EcalBarrelMonitorClient.cfi"

     replace ecalBarrelMonitorClient.maskFile = "/nfshome0/ecalpro/MASKING-DQM/maskfile-EB.dat"
     replace ecalBarrelMonitorClient.location = "P5"

     replace ecalBarrelMonitorClient.updateTime = 2

     replace ecalBarrelMonitorClient.enabledClients = { "Integrity",
                                                        "StatusFlags",
                                                        "Occupancy",
                                                        "PedestalOnline",
                                                        #"Pedestal",
                                                        #"TestPulse",
                                                        #"Laser",
                                                        "Timing",
                                                        "Cosmic",
                                                        "Cluster",
                                                        #"TriggerTower",
                                                        "Summary" }

     module preScaler = Prescaler{ int32 prescaleFactor = 1 }

     module dqmQTestEB = QualityTester{
       untracked int32 prescaleFactor = 4
       untracked bool getQualityTestsFromFile = true
       untracked FileInPath qtList = "DQM/Integration/test/EcalBarrelQualityTests.xml"
       untracked string reportThreshold = "red"
     }


include "RecoEcal/EgammaClusterProducers/data/ecalClusteringSequence.cff"

     replace islandBasicClusters.IslandBarrelSeedThr = 0.150 # 0.500
     replace islandBasicClusters.IslandEndcapSeedThr = 0.150 # 0.180

     replace hybridSuperClusters.HybridBarrelSeedThr = 0.150 # 1.000
     replace hybridSuperClusters.step = 1      # 17
     replace hybridSuperClusters.eseed = 0.150 # 0.350

     replace islandSuperClusters.seedTransverseEnergyThreshold = 0.150 # 1.000

     sequence ecalDataSequence = { preScaler,
                                         ecalEBunpacker,
                                         ecalUncalibHit,
                                         ecalUncalibHit2,
                                         ecalRecHit,
                                         ecalTriggerPrimitiveDigis,
                                         islandBasicClusters,
                                         islandSuperClusters,
                                         hybridSuperClusters }

     sequence ecalBarrelMonitorSequence = { ecalBarrelMonitorModule,
                                            dqmEnv,
                                            ecalBarrelMonitorClient,
                                            dqmQTestEB,
                                            dqmSaver }

     sequence ecalBarrelCosmicTasksSequenceP5 = { ecalBarrelOccupancyTask,
                                                  ecalBarrelIntegrityTask,
                                                  ecalBarrelStatusFlagsTask,
                                                  #ecalBarrelSelectiveReadoutTask,
                                                  #ecalBarrelRawDataTask,
                                                  #ecalBarrelLaserTask,
                                                  ecalBarrelPedestalOnlineTask,
                                                  #ecalBarrelPedestalTask,
                                                  #ecalBarrelTestPulseTask,
                                                  ecalBarrelTriggerTowerTask,
                                                  ecalBarrelTimingTask,
                                                  ecalBarrelCosmicTask }

     path p = { ecalDataSequence, ecalBarrelMonitorSequence }

     endpath q = { ecalBarrelCosmicTasksSequenceP5, ecalBarrelClusterTask }

include "CondCore/DBCommon/data/CondDBSetup.cfi"

      es_source ecalConditions = PoolDBESSource{
        using CondDBSetup

        VPSet toGet = {
            { string record = "EcalPedestalsRcd"
              string tag = "EcalPedestals_v2_online" },
            { string record = "EcalADCToGeVConstantRcd"
              string tag = "EcalADCToGeVConstant_CosmGain200" },
            { string record = "EcalChannelStatusRcd"
              string tag = "EcalChannelStatus_FromCruzet_v3_online" },
            { string record = "EcalGainRatiosRcd"
              string tag = "EcalGainRatios_TestPulse_online" },
            { string record = "EcalIntercalibConstantsRcd"
              string tag = "EcalIntercalibConstants_CosmGain200" },
            { string record = "EcalWeightXtalGroupsRcd"
              string tag = "EcalWeightXtalGroups_mc" },
            { string record = "EcalTBWeightsRcd"
              string tag = "EcalTBWeights_mc" },
            { string record = "EcalLaserAlphasRcd"
              string tag = "EcalLaserAlphas_mc" },
            { string record = "EcalLaserAPDPNRatiosRcd"
              string tag = "EcalLaserAPDPNRatios_mc" },
            { string record = "EcalLaserAPDPNRatiosRefRcd"
              string tag = "EcalLaserAPDPNRatiosRef_mc" }
        }

        string connect = "frontier://(proxyurl=http://localhost:3128)(serverurl=http://frontier1.cms:8000/FrontierOnProd)(serverurl=http://frontier2.cms:8000/FrontierOnProd)(retrieve-ziplevel=0)/CMS_COND_20X_ECAL"
#        string connect = "frontier://FrontierProd/CMS_COND_20X_ECAL"

        untracked bool siteLocalConfig = false
        untracked uint32 authenticationMethod = 1
        string timetype = "runnumber"
        untracked uint32 messagelevel = 0
      }

include "CalibCalorimetry/EcalLaserCorrection/data/ecalLaserCorrectionService.cfi"

     service = MessageLogger{
       untracked vstring destinations = { "cout" }
       untracked vstring categories = { "EcalRawToDigiDev",
                                        "EcalRawToDigiDevTriggerType",
                                        "EcalRawToDigiDevTpg",
                                        "EcalRawToDigiDevNumTowerBlocks",
                                        "EcalRawToDigiDevTowerId",
                                        "EcalRawToDigiDevTowerSize",
                                        "EcalRawToDigiDevChId",
                                        "EcalRawToDigiDevGainZero",
                                        "EcalRawToDigiDevGainSwitch",
                                        "EcalRawToDigiDevDccBlockSize",
                                        "EcalRawToDigiDevMemBlock",
                                        "EcalRawToDigiDevMemTowerId",
                                        "EcalRawToDigiDevMemChId",
                                        "EcalRawToDigiDevMemGain",
                                        "EcalRawToDigiDevTCC",
                                        "EcalRawToDigiDevSRP",
                                        "EcalDCCHeaderRuntypeDecoder",
                                        "EcalBarrelMonitorModule"
                                      }
       untracked PSet cout = {
         untracked string threshold = "WARNING"
         untracked PSet default                        = { untracked int32 limit = 0 }
         untracked PSet EcalRawToDigiDev               = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevTriggerType    = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevTpg            = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevNumTowerBlocks = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevTowerId        = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevTowerSize      = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevChId           = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevGainZero       = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevGainSwitch     = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevDccBlockSize   = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevMemBlock       = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevMemTowerId     = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevMemChId        = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevMemGain        = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevTCC            = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevSRP            = { untracked int32 limit = 1000 }
         untracked PSet EcalDCCHeaderRuntypeDecoder    = { untracked int32 limit = 1000 }
         untracked PSet EcalBarrelMonitorModule        = { untracked int32 limit = 0 }
         untracked bool noTimeStamps = true
         untracked bool noLineBreaks = true
       }
     }

}
