process SIPIXELDQM = {

  #=========================================================================================
  # Sources
    source = PoolSource {
      untracked vstring fileNames = {
      'file:/home/dqm/tracker/data/gen_sim_digi_raw_1k_Cosmics_200pre9.root'
      }
    }
    untracked PSet maxEvents = {untracked int32 input = -1}
  # End Sources
  #=========================================================================================

  # MessageLogger service
  include "FWCore/MessageLogger/data/MessageLogger.cfi"

  #=========================================================================================
    service = AdaptorConfig {}
  #=========================================================================================

  # Geometry  & Magnetic Field & Cabling
  include "Configuration/StandardSequences/data/FrontierConditions_GlobalTag.cff"
  replace GlobalTag.globaltag = "CRUZET2_V1::All"
  include "Geometry/TrackerSimData/data/trackerSimGeometryXML.cfi"
  include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"
  include "MagneticField/Engine/data/uniformMagneticField.cfi"
  replace UniformMagneticFieldESProducer.ZFieldInTesla = 0.0
  es_prefer = UniformMagneticFieldESProducer{}
        
  # Raw to Digi conversion
  include "EventFilter/SiPixelRawToDigi/data/SiPixelRawToDigi.cfi"
  replace siPixelDigis.InputLabel = "source"
  replace siPixelDigis.IncludeErrors = true
  
  # SiPixel DQM Modules:
    # SiPixelMonitorRawData
    	include "DQM/SiPixelMonitorRawData/data/SiPixelMonitorRawData.cfi"
        replace SiPixelRawDataErrorSource.saveFile = false
	replace SiPixelRawDataErrorSource.isPIB = true
	replace SiPixelRawDataErrorSource.slowDown = false

    # SiPixelMonitorDigi
    	include "DQM/SiPixelMonitorDigi/data/SiPixelMonitorDigi.cfi"
        replace SiPixelDigiSource.saveFile = false
	replace SiPixelDigiSource.isPIB = true
	replace SiPixelDigiSource.slowDown = false
	
  ################ The Client (SiPixelEDAClient) ################
   module sipixelEDAClient = SiPixelEDAClient {
     untracked int32  SummaryCreationFrequency = 1
     untracked int32  StaticUpdateFrequency = 1
   }
  # End Module Configuration
  #=========================================================================================
  
  # DQM services
    include "DQMServices/Core/data/DQM.cfg"    
    #replace DQMStore.referenceFileName = "/home/dqm/tracker/pixel_reference.root"
    
  # DQM Online Environment
    # use include file for dqmEnv dqmSaver
    include "DQMServices/Components/data/DQMEnvironment.cfi"
    replace dqmSaver.convention    = "Online"
    replace dqmSaver.dirName       = "."
    replace dqmSaver.producer      = "DQM"
    replace dqmEnv.subSystemFolder = "Pixel"
    replace dqmSaver.saveByLumiSection = -1
    replace dqmSaver.saveByMinute    = -1
    replace dqmSaver.saveByEvent     = -1
    replace dqmSaver.saveByRun         = 1
    replace dqmSaver.saveAtJobEnd      = true

    module qTester = QualityTester {
      untracked FileInPath qtList = "DQM/SiPixelMonitorClient/test/sipixel_qualitytest_config.xml"
      untracked bool getQualityTestsFromFile = true
      untracked int32 QualityTestPrescaler = 1
    }
  #=========================================================================================

   service = ModuleWebRegistry { }
   service = LockService { untracked vstring labels = { "source" } }
   
######################## Scheduling
    sequence DIGIreco = {
      siPixelDigis
    }
    sequence RAWmonitor = {
      SiPixelRawDataErrorSource
    }
    sequence DIGImonitor = {
      SiPixelDigiSource
    }
    sequence DQMmodules = {
      qTester,
      dqmEnv,
      dqmSaver
    }
    
  # End Schedule
  #=========================================================================================
  path p = {
             DIGIreco,
	     DQMmodules,
	     RAWmonitor,
	     DIGImonitor,
	     sipixelEDAClient
	   }

}
